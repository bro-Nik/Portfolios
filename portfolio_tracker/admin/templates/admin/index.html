{% extends "base.html" %}
{% block title %} Home / Admin {% endblock %}
{% block content %}

{% include 'admin/menu.html' %}

<div class="row gap-5">

  <div>
    <div class="mb-3">
      <h6>Пользователи</h6>
    </div>
    <div class="d-flex gap-3 small-text">
      <div>Пользователи - <span class="text-average">{{ info.users_count }}</span></div>
      <div>Администраторы - <span class="text-average">{{ info.admins_count }}</span></div>
    </div>
  </div>

  <div>
    <div class="mb-3">
      <h6>Последнее обновление цен</h6>
    </div>
    <div class="d-flex gap-3 small-text">
      <div>Crypto - <span class="text-average">{{ info.crypto_update }}</span></div>
      <div>Stocks - <span class="text-average">{{ info.stocks_update }}</span></div>
      <div>Currency - <span class="text-average">{{ info.currency_update }}</span></div>
    </div>
  </div>

  <div>
    <div class="mb-3">
      <h6>Задачи</h6>
    </div>
    <div class="tasks-box small-text"></div>
  </div>

  <div>
    <div class="mb-3">
      <h6>Redis</h6>
    </div>
    <div class="d-grid">
      <a class="small-text text-decoration-none" href="{{ url_for('.index_action', action='redis_delete_all') }}">
          Удалить все из Redis
      </a>
    </div>
  </div>
  <div id="temp"></div>
</div>

{% endblock %}

{% block after_scripts %}
<script>

  function UpdateTasks() {
    var $box = $('.tasks-box'),
      request = $.get("{{ url_for('.tasks') }}");
    $box.empty().append(`<div class="spinner-border spinner-border-sm text-secondary"></div>`);

    request.done(function(tasks) {
      $box.empty();

      for (let i = 0; i < tasks.length; i++) {
        var status = "";
        if (tasks[i].task_id) status = ` - <span class="text-average">Работает</span>`;
        $box.append(`<div><span>${tasks[i].name}</span><span class="ms-auto">${status}</span></div>`);
      }
    })
  }

  UpdateTasks();
</script>

{% endblock %}
