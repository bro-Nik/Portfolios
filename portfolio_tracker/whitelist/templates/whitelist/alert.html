{% extends "modal_base.html" %}
{% set modal_fullscreen = False %}

{% set modal_title = gettext('Edit alert') if alert else gettext('Add alert') %}

{% block content %}
{% set asset_id = request.args.get('asset_id') %}
<form data-url="{{ url_for('whitelist.alert_update', whitelist_ticker_id=whitelist_ticker_id if whitelist_ticker_id, ticker_id=ticker_id, asset_id=asset_id if asset_id, alert_id=alert.id if alert) }}">
  <div class="row g-2">

    <div class="col-md-12">
      <div id="alertPrice" class="mb-1">
        <label class="form-label h7">{% trans %}Price{% endtrans %}</label>
        <div class="input-group mb-1">
          <span class="input-prefix">$</span>
          <input type="number" step="any" class="form-control rounded-3 focus"
            value="{{ alert.price if alert else price }}" name="price" autocomplete="off" required {{ 'disabled' if alert.transaction }}>
          <input type="hidden" name="type" value="{{ alert.type if alert else 'down' }}">
        </div>
        <span class="small-text alert-price-info">
          {{ (gettext('When the price is above') if alert.type == 'up' else gettext('When the price is below')) if alert else gettext('When the price is below') }} {{ alert.price if alert else price }}$
        </span>
      </div>
    </div>

    <div class="col-md-12">
      <div class="mb-3">
        <label class="form-label h7">{% trans %}Comment{% endtrans %}</label>
        <textarea class="form-control" name="comment">{{ alert.comment if alert and alert.comment }}</textarea>
      </div>
    </div>

  </div>
  <button class="btn btn-primary rounded-3 w-100" type="submit">{{ modal_title }}</button>
</form>

<script>
  $('#alertPrice').on('input', 'input[name=price]', function () {
    var price_now = +{{ price }},
      alert_price = +$(this).val(),
      up = "{{ gettext('When the price is above') }}" + ' ',
      down = "{{ gettext('When the price is below') }}" + ' ';
    if (alert_price > price_now) {
      $('#alertPrice .alert-price-info').text(up + alert_price + '$');
      $('#alertPrice').find('input[name=type]').val('up');
    } else {
      $('#alertPrice .alert-price-info').text(down + alert_price + '$');
      $('#alertPrice').find('input[name=type]').val('down');
    }
  })
</script>
{% endblock %}
