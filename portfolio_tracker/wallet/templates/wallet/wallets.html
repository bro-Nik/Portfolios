{% extends "base.html" %}
{% block title %} Кошельки {% endblock %}

{% block content %}
<div class="mb-5">
  <div class="row xs-mb-3">
    <div class="col-auto">
      <h1>Кошельки</h1>
    </div>
    <div class="col-auto ms-auto">
      <button class="btn btn-primary open-modal" type="button" data-modal-id="WalletSettingsModal" data-url="{{ url_for('.wallet_settings') }}">Добавить кошелек</button>

	    <button type="button" class="btn btn-warning" role="button" id="dropdownAction" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Перевод
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownAction">
        <button class="dropdown-item open-modal" type="button" data-modal-id="WalletInputOutCashModal" data-url="{{ url_for('.wallet_in_out_get') }}">Ввод-вывод</button>
        <button class="dropdown-item open-modal" type="button" data-modal-id="WalletTransferCashModal" data-url="{{ url_for('.wallet_transfer_get') }}">Перевод</button>
      </div>

    </div>
  </div>
</div>

<div class="row xs-mb-3">

  <div class="col-auto">
    <p class="small_text">Вложено / сейчас</p>
    <span class="text-average">
      ${{ all.total_spent|int|number_group }} / 
      <span class="{{ 'text-green' if all.profit|int > 0 }} {{ 'text-red' if all.profit|int < 0 }}">
        ${{ all.cost_now|int|number_group }}
      </span>
    </span>
  </div>

  <div class="col-auto">
    <p class="small_text">В ордерах</p>
    <span class="text-average">
      ${{ all.in_orders|int|number_group }}
    </span>
  </div>

  <div class="col-auto">
    <p class="small_text">Свободные</p>
    <span class="text-average">
      {{ '-' if all.free|int < 0 }}${{ all.free|int|abs|number_group }}
    </span>
  </div>
</div>

<div class="big-table">
  <form id="WalletsForm" action="{{ url_for('.wallets_action') }}">
    <table class="table table-sm align-middle table-hover bootstrap-table" data-search="true">
      <thead>
        <tr>
          <th class="main-tab-checkbox">
            <input class="form-check-input check-all" type="checkbox">
          </th>
          <th data-sortable="true">Наименование</th>
          <th data-sortable="true" data-sort-name="total_spent">Вложено</th>
          <th data-sortable="true" data-sort-name="cost_now">Стоимость сейчас</th>
          <th data-sortable="true" data-sort-name="in_orders">В ордерах</th>
          <th data-sortable="true" data-sort-name="free">Свободные</th>
          <th></th>

          <!-- For sorting -->
          <th class="visually-hidden" data-sortable="true" data-field="total_spent">Вложено</th>
          <th class="visually-hidden" data-sortable="true" data-field="cost_now">Стоимость сейчас</th>
          <th class="visually-hidden" data-sortable="true" data-field="in_orders">В ордерах</th>
          <th class="visually-hidden" data-sortable="true" data-field="free">Свободные</th>
        </tr>
      </thead>
      <tbody>
        {% for id in wallets %}
          {% set wallet = wallets[id] %}
          <tr>
            <td>
              <input class="form-check-input to-check" type="checkbox" value="{{ id }}">
            </td>

            <td class="text-average">
              <a class="link-dark text-decoration-none open-modal" href="#" data-url="{{ url_for('.wallet_info', wallet_id=id) }}" data-modal-id="WalletInfoModal">
                {{ wallet.name }}
              </a>
            </td>

            <td>{{ '$' + wallet.total_spent|int|number_group if wallet.total_spent else '-' }}</td>

            <td>{{ '$' + wallet.cost_now|int|number_group if wallet.cost_now else '-' }}</td>

            <td>{{ '$' + wallet.in_orders|int|number_group if wallet.in_orders else '-' }}</td>

            <td>
              {% if not (wallet.free == 0 and wallet.total_spent == 0) %}
                {{ '-' if wallet.free < 0 }}${{ wallet.free|int|abs|number_group }}
              {% else %}
                -
              {% endif %}
            </td>

            <td class="align-middle text-end">
              <div class="dropdown dropstart">
                <a href="#" class="link-secondary" role="button" data-bs-toggle="dropdown" aria-expanded="false">
	                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="ms-2" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/></svg>
                </a>
                <div class="dropdown-menu">
                  <a href="#" class="dropdown-item open-modal" data-modal-id="WalletSettingsModal" data-url="{{ url_for('.wallet_settings', wallet_id=id) }}">
                    Изменить
                  </a>

                  <a href="#" class="dropdown-item link-danger {{ 'open-modal-confirmation' if wallet.can_delete else 'opacity-50 disabled' }}" data-title="Удалить кошелек {{ wallet.name }}?"
                    data-id="{{ id }}"> Удалить
                  </a>
                </div>
              </div>
            </td>

            <!-- For sorting -->
            <td class="visually-hidden">{{ wallet.total_spent }}</td>
            <td class="visually-hidden">{{ wallet.cost_now }}</td>
            <td class="visually-hidden">{{ wallet.in_orders }}</td>
            <td class="visually-hidden">{{ wallet.free }}</td>

          </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Actions buttons -->
    <div class="sticky-bottom-buttons">
      <a class="open-modal-confirmation" data-action="delete" data-title="Удалить кошельки?">Удалить</a>
    </div>

  </form>
</div>
  
{% endblock %}
